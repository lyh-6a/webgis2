(function(){var e={62764:function(e,t,n){"use strict";n(66992),n(88674),n(19601),n(17727);var a=n(28935),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("el-container",{staticClass:"app-out-pannel"},[n("el-header",{staticClass:"sys-header"},[n("span",[e._v("标题")]),n("div",{staticClass:"user-info"},[n("i",{staticClass:"el-icon-user"}),n("span",[e._v("当前用户：")]),n("span",{on:{click:e.handleUserLogin}},[e._v(e._s(e.username))])])]),n("el-container",{staticClass:"app-content-pannel"},[n("el-aside",{staticClass:"sys-menu"},[n("el-menu",{staticClass:"el-menu-vertical-demo",attrs:{"default-active":"1","background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b",collapse:!0},on:{select:e.handleMenuSelect}},[n("el-menu-item",{attrs:{index:"1"}},[n("i",{staticClass:"el-icon-monitor"}),n("span",{attrs:{slot:"title"},slot:"title"},[e._v("首页大屏")])]),n("el-menu-item",{attrs:{index:"2"}},[n("i",{staticClass:"el-icon-picture-outline"}),n("span",{attrs:{slot:"title"},slot:"title"},[e._v("标题")])])],1)],1),n("el-main",{staticClass:"sys-content"},[n("router-view")],1)],1)],1),n("el-dialog",{attrs:{title:"用户登录/注册",visible:e.loginDialogVisible,width:"30%","show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.loginDialogVisible=t}}},[n("div",{staticClass:"login-content"},[n("div",{directives:[{name:"show",rawName:"v-show",value:!e.loginSwitch,expression:"!loginSwitch"}],staticClass:"login-content-login"},[n("p",[e._v("用户名：")]),n("el-input",{attrs:{placeholder:"请输入用户名",clearable:""},model:{value:e.userNameInput,callback:function(t){e.userNameInput=t},expression:"userNameInput"}}),n("p",[e._v("密码：")]),n("el-input",{attrs:{placeholder:"请输入密码","show-password":""},model:{value:e.userPsdInput,callback:function(t){e.userPsdInput=t},expression:"userPsdInput"}})],1),n("div",{directives:[{name:"show",rawName:"v-show",value:e.loginSwitch,expression:"loginSwitch"}],staticClass:"login-content-insert"},[n("p",[e._v("用户名：")]),n("el-input",{attrs:{placeholder:"请输入用户名",clearable:""},model:{value:e.userNameInput_insert,callback:function(t){e.userNameInput_insert=t},expression:"userNameInput_insert"}}),n("p",[e._v("密码：")]),n("el-input",{attrs:{placeholder:"请输入密码",clearable:""},model:{value:e.userPsdInput_insert,callback:function(t){e.userPsdInput_insert=t},expression:"userPsdInput_insert"}}),n("p",[e._v("手机号：")]),n("el-input",{attrs:{placeholder:"请输入手机号",clearable:""},model:{value:e.userPhoneInput_insert,callback:function(t){e.userPhoneInput_insert=t},expression:"userPhoneInput_insert"}}),n("p",[e._v("邮箱：")]),n("el-input",{attrs:{placeholder:"请输入邮箱",clearable:""},model:{value:e.userEmailInput_insert,callback:function(t){e.userEmailInput_insert=t},expression:"userEmailInput_insert"}})],1)]),n("br"),n("el-switch",{attrs:{"active-text":"注册","inactive-text":"登录"},model:{value:e.loginSwitch,callback:function(t){e.loginSwitch=t},expression:"loginSwitch"}}),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.loginDialogVisible=!1}}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:e.userLogin}},[e._v(e._s(e.loginSwitch?"注册":"登录"))])],1)],1)],1)},s=[],i=(n(68309),n(26166)),o=n.n(i),l=n(57421),c=n.n(l),u={name:"App",components:{},data:function(){return{username:"未登录",loginDialogVisible:!0,userNameInput:"",userPsdInput:"",loginSwitch:!1,userNameInput_insert:"",userPsdInput_insert:"",userPhoneInput_insert:"",userEmailInput_insert:""}},methods:{handleMenuSelect:function(e){"1"===e?this.$router.push("/"):"2"===e&&this.$router.push("/onemap")},handleUserLogin:function(){this.loginDialogVisible=!0},userLogin:function(){var e=this;if(e.loginSwitch){var t=e.userNameInput_insert,n=e.userPsdInput_insert,a=e.userPhoneInput_insert,r=e.userEmailInput_insert;if(!t||!n)return void e.$message({message:"请填写用户名或密码",type:"warning"});o().post("http://localhost:3001/user/insert",c().stringify({name:t,psd:n,phone:a,email:r})).then((function(t){"success"===t.data.status?e.$message({message:"用户注册成功，请登录",type:"success"}):e.$message.error("用户注册失败")})).catch((function(t){e.loginDialogVisible=!1,console.log(t)}))}else{var s=e.userNameInput,i=e.userPsdInput;o().get("http://localhost:3001/user/get",{params:{name:s}}).then((function(t){if("success"===t.data.status){var n=t.data.data[0].psd;n===i?(e.$message({message:"恭喜你，登陆成功",type:"success"}),e.username=t.data.data[0].name,e.loginDialogVisible=!1):e.$message.error("登录失败，用户名或密码错误")}})).catch((function(t){e.loginDialogVisible=!0,e.$message.error("登陆失败，用户名错误"),console.log(t)}))}}}},p=u,m=n(43736),d=(0,m.Z)(p,r,s,!1,null,null,null),g=d.exports,h=n(74549),f=n.n(h),v=n(12809),w=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"datavisual-page"},[n("MapDataVisual")],1)},y=[],b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"mapview"},[n("div",{ref:"bmap",staticStyle:{position:"absolute",height:"100%",width:"100%"}}),n("div",{ref:"echart2",staticStyle:{width:"400px",height:"250px",top:"30px",left:"50px"}})])},_=[],M=n(67906),k=n(13571),x=n(16198),T=(n(21249),n(92222),{"浙江":[120.103332,29.104967],"云南":[101.301313,24.141072],"新疆":[85.658103,42.002464],"西藏":[89.115946,31.100655],"四川":[102.897281,34.115401],"陕西":[108.76452,33.38],"山西":[112.382576,37.6985],"山东":[118.430148,36.177868],"青海":[96.477113,35.723426],"宁夏":[105.985434,37.366408],"内蒙古":[111.071687,41.38647],"辽宁":[123.516401,41.473741],"江西":[115.633583,27.734628],"吉林":[126.450145,43.501435],"湖南":[111.57941,28.015791],"湖北":[113.030128,30.899748],"黑龙江":[127.88688,46.770255],"河南":[113.585097,33.800391],"北京市":[117.349074,40.222103],"天津市":[121.48,39.220634],"海南":[109.7747777,19.222206],"贵州":[106.611163,23.015048],"广西":[108.411451,40.97],"甘肃":[103.797119,35.948809],"福建":[118.024644,26.003525],"安徽":[117.187964,32.01357],"上海":[121.681155,31.213965],"重庆":[107.76514,29.799532],"江苏":[119.965609,32.471626],"广东":[113.357876,23.277226],"河北":[115.402864,38.222459]}),Z=T,C=n(84759),D=n.n(C),V=n(51969),S={options:{url:"https://js.arcgis.com/4.18/init.js",css:"https://js.arcgis.com/4.18/esri/themes/light/main.css"}},$=S;n(4226);n(84759),n(76484);var z={name:"BmapScatter",return:{station:[],currentData:[]},mounted:function(){this.initechart2(),this.initBmap()},methods:{initechart2:function(){var e=this;return(0,x.Z)((0,M.Z)().mark((function t(){var n,a,r,s,i,o,l,c;return(0,M.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e,t.next=3,(0,V.loadModules)(["esri/tasks/QueryTask","esri/tasks/support/Query"],$.options);case 3:a=t.sent,r=(0,k.Z)(a,2),s=r[0],i=r[1],o=new s({url:"https://services3.arcgis.com/U26uBjSD32d7xvm2/arcgis/rest/services/TONGJI/FeatureServer/6"}),l=new i,l.returnGeometry=!1,l.outFields=["*"],l.where="1=1",c=[],o.execute(l).then((function(e){if(e.features.length>0)return e.features.map((function(e){c.push({value:e.attributes.车站,X:e.attributes.X,Y:e.attributes.Y,Name:e.attributes.NAME})})),n.station=c,c;n.$message({message:"暂时没有省份数据",type:"warning"})})),console.log(c),setTimeout((function(){var t=function(e){for(var t=[],n=0;n<e.length;n++){var a=Z[c[n].Name];a&&t.push({name:c[n].Name,value:c[n].value})}return t},n=function(e){for(var t=[],n=0;n<e.length;n++){var a=Z[c[n].Name];a&&t.push({value:c[n].Name})}return t},a=C.init(e.$refs.echart2),r={title:{text:"各省火车站数量"},tooltip:{},legend:{data:t(c)},xAxis:{data:n(c)},yAxis:{},series:[{name:"省",type:"bar",data:t(c)}]};a.setOption(r)}),4e3);case 16:case"end":return t.stop()}}),t)})))()},initBmap:function(){var e=this.$echarts.init(this.$refs.bmap);e.setOption({series:[{type:"map",map:"china"}],title:{text:"各省火车站数量",left:"center"},tooltip:{formatter:function(e){return"".concat(e.seriesName,"<br />").concat(e.marker," ").concat(e.data.name,": ").concat(e.data.value[2])}}})}}},I=z,L=(0,m.Z)(I,b,_,!1,null,null,null),P=L.exports,Q={name:"DataVisual",components:{MapDataVisual:P},methods:{}},B=Q,N=(0,m.Z)(B,w,y,!1,null,null,null),O=N.exports,F=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"onemap-page"},[n("Mapview"),n("MapTools"),n("MapTree"),n("XZQHComponent"),n("ResultTable")],1)},j=[],E=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"mapview-pannel"},[n("div",{attrs:{id:"mapview"}}),n("div",{attrs:{id:"basemapToggle"}}),n("div",{attrs:{id:"scaleBar"}}),n("div",{attrs:{id:"zoom"}}),n("div",{staticClass:"view-change",on:{click:e.handleViewChale}},[n("span",[e._v(e._s(e.viewModel))])])])},H=[],R={name:"Mapview",components:{},data:function(){return{viewModel:"3D"}},mounted:function(){this._createMapView()},methods:{_createMapView:function(){var e=this;return(0,x.Z)((0,M.Z)().mark((function t(){var n,a,r,s,i,o,l,c,u,p,m,d;return(0,M.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return document.getElementById("basemapToggle").innerHTML="",document.getElementById("scaleBar").innerHTML="",document.getElementById("zoom").innerHTML="",t.next=5,(0,V.loadModules)(["esri/Map","esri/views/MapView","esri/Basemap","esri/layers/TileLayer","esri/widgets/BasemapToggle","esri/widgets/ScaleBar","esri/widgets/Zoom"],$.options);case 5:n=t.sent,a=(0,k.Z)(n,7),r=a[0],s=a[1],i=a[2],o=a[3],l=a[4],c=a[5],u=a[6],p=new i({baseLayers:[new o({url:"http://map.geoq.cn/arcgis/rest/services/ChinaOnlineStreetPurplishBlue/MapServer",title:"Basemap"})],title:"basemap",id:"basemap"}),m=new r({basemap:p}),d=new s({container:"mapview",map:m,zoom:10,center:[104.072745,30.663774]}),e.basemapToggle=new l({view:d,nextBasemap:"hybrid",container:"basemapToggle"}),d.ui.add(e.basemapToggle),e.scaleBar=new c({view:d,unit:"metric",container:"scaleBar"}),d.ui.add(e.scaleBar),e.zoom=new u({view:d,container:"zoom"}),d.ui.add(e.zoom),d.ui.components=[],e.$store.commit("_setDefaultMapView",d);case 25:case"end":return t.stop()}}),t)})))()},_createSceneView:function(){var e=this;return(0,x.Z)((0,M.Z)().mark((function t(){var n,a,r,s,i,o,l,c,u;return(0,M.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return document.getElementById("basemapToggle").innerHTML="",document.getElementById("scaleBar").innerHTML="",document.getElementById("zoom").innerHTML="",t.next=5,(0,V.loadModules)(["esri/Map","esri/views/SceneView","esri/Basemap","esri/layers/TileLayer"],$.options);case 5:n=t.sent,a=(0,k.Z)(n,4),r=a[0],s=a[1],i=a[2],o=a[3],l=new i({baseLayers:[new o({url:"http://map.geoq.cn/arcgis/rest/services/ChinaOnlineStreetPurplishBlue/MapServer",title:"Basemap"})],title:"basemap",id:"basemap"}),c=new r({basemap:l}),u=new s({container:"mapview",map:c}),setTimeout((function(){u.goTo({zoom:10,center:[104.072745,30.663774]})}),3e3),u.ui.components=[],e.$store.commit("_setDefaultMapView",u);case 17:case"end":return t.stop()}}),t)})))()},handleViewChale:function(){"3D"===this.viewModel?(this._createSceneView(),this.viewModel="2D"):(this._createMapView(),this.viewModel="3D")}}},X=R,A=(0,m.Z)(X,E,H,!1,null,null,null),G=A.exports,U=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"maptools-view"},[n("span",{staticClass:"maptools-item",attrs:{id:"xzqh"},on:{click:e.handleMapToolsitemClick}},[e._v("行政区导航")]),n("span",{staticClass:"maptools-item",attrs:{id:"maptree"},on:{click:e.handleMapToolsitemClick}},[e._v("目录树管理")]),n("el-dropdown",{staticClass:"maptools-item",attrs:{trigger:"click"},on:{command:e.handleCommand}},[n("span",{staticClass:"el-dropdown-link"},[e._v("地图测量"),n("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{icon:"el-icon-plus",command:"distance"}},[e._v("距离测量")]),n("el-dropdown-item",{attrs:{icon:"el-icon-circle-plus",command:"area"}},[e._v("面积测量")])],1)],1),n("el-dropdown",{staticClass:"maptools-item",attrs:{trigger:"click"},on:{command:e.handleCommand}},[n("span",{staticClass:"el-dropdown-link"},[e._v("更多功能"),n("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{icon:"el-icon-search",command:"spacequery"}},[e._v("空间查询")]),n("el-dropdown-item",{attrs:{icon:"el-icon-film",command:"morescreen"}},[e._v("多屏对比")]),n("el-dropdown-item",{attrs:{icon:"el-icon-reading",command:"swipanalyst"}},[e._v("卷帘分析")]),n("el-dropdown-item",{attrs:{icon:"el-icon-picture-outline",command:"printmap"}},[e._v("地图打印")]),n("el-dropdown-item",{attrs:{icon:"el-icon-view",command:"openPopup"}},[e._v("开启图层弹窗")])],1)],1),n("span",{staticClass:"maptools-item",attrs:{id:"clear"},on:{click:e.handleMapToolsitemClick}},[e._v("清屏")])],1)},W=[],q=(n(9653),n(57327),n(41539),{name:"MapTools",mounted:function(){var e=this,t=setInterval((function(){e.$store.getters._getDefaultMapView&&(e._initSketchTool(),clearInterval(t))}),200)},methods:{_initSketchTool:function(){var e=this;return(0,x.Z)((0,M.Z)().mark((function t(){var n,a,r,s,i,o,l,c;return(0,M.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e,a=n.$store.getters._getDefaultMapView,t.next=4,(0,V.loadModules)(["esri/widgets/Sketch/SketchViewModel","esri/layers/GraphicsLayer"],$.options);case 4:r=t.sent,s=(0,k.Z)(r,2),i=s[0],o=s[1],l=a.map.findLayerById("polygonGraphicLayer"),l&&a.map.remove(l),n.graphicsLayer=new o({id:"polygonGraphicLayer",elevationInfo:{mode:"on-the-ground"}}),a.map.add(n.graphicsLayer),c={type:"simple-fill",color:"rgba(216,30,6, 0.4)",style:"solid",outline:{color:"#d81e06",width:1}},n.sketchViewModel=new i({updateOnGraphicClick:!1,view:a,layer:n.graphicsLayer,polygonSymbol:c});case 14:case"end":return t.stop()}}),t)})))()},handleMapToolsitemClick:function(e){switch(e.target.id){case"xzqh":this.openXZQHPannel();break;case"maptree":this.openMapTreePannel();break;case"clear":this.handleClearMap();break;default:break}},handleCommand:function(e){switch(e){case"distance":this.initDistanceMap();break;case"area":this.initAreaMap();break;case"spacequery":this.initSpaceQuery();break;case"morescreen":this.$router.push("/onemap/one");break;case"swipanalyst":this._initSwipe();break;case"printmap":this.handlePrintMap();break;case"openPopup":this.openMapPopup();break;default:break}},openXZQHPannel:function(){var e=this.$store.getters._getDefaultXZQHVisible;this.$store.commit("_setDefaultXZQHVisible",!e)},openMapTreePannel:function(){var e=this.$store.getters._getDefaultMapTreeVisible;this.$store.commit("_setDefaultMapTreeVisible",!e)},initDistanceMap:function(){var e=this;return(0,x.Z)((0,M.Z)().mark((function t(){var n,a,r,s,i;return(0,M.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e,a=n.$store.getters._getDefaultMapView,t.next=4,(0,V.loadModules)(["esri/widgets/DistanceMeasurement2D"],$.options);case 4:r=t.sent,s=(0,k.Z)(r,1),i=s[0],e.measurementWidget&&e.measurementWidget.destroy(),e.measurementWidget=new i({view:a}),a.ui.add(e.measurementWidget,"top-left");case 10:case"end":return t.stop()}}),t)})))()},initAreaMap:function(){var e=this;return(0,x.Z)((0,M.Z)().mark((function t(){var n,a,r,s,i;return(0,M.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e,a=n.$store.getters._getDefaultMapView,t.next=4,(0,V.loadModules)(["esri/widgets/AreaMeasurement2D"],$.options);case 4:r=t.sent,s=(0,k.Z)(r,1),i=s[0],e.measurementWidget&&e.measurementWidget.destroy(),e.measurementWidget=new i({view:a}),a.ui.add(e.measurementWidget,"top-left");case 10:case"end":return t.stop()}}),t)})))()},initSpaceQuery:function(){var e=this;return(0,x.Z)((0,M.Z)().mark((function t(){var n,a,r,s,i,o,l;return(0,M.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e,a=n.$store.getters._getDefaultMapView,t.next=4,(0,V.loadModules)(["esri/Graphic","esri/layers/GraphicsLayer"],$.options);case 4:r=t.sent,s=(0,k.Z)(r,2),i=s[0],o=s[1],l=a.map.findLayerById("polygonGraphicLayer"),l&&a.map.remove(l),n.graphicsLayer=new o({id:"polygonGraphicLayer",elevationInfo:{mode:"on-the-ground"}}),a.map.add(n.graphicsLayer),n.sketchViewModel.create("polygon"),n.sketchViewModel.on("create-complete",(function(e){var t=new i({geometry:e.geometry,symbol:n.sketchViewModel.graphic.symbol});n.graphicsLayer.add(t)})),n.sketchViewModel.on("create",(function(e){"complete"===e.state&&n.handleSpaceQuery(e.graphic)}));case 15:case"end":return t.stop()}}),t)})))()},handleSpaceQuery:function(e){var t=this,n=t.$store.getters._getDefaultMapView,a=n.map.findLayerById("layerid");if(a){var r=a.createQuery();r.geometry=e.geometry,a.queryFeatures(r).then((function(e){var n=[];e.features.length>0?(t.renderResultLayer(e.features),e.features.map((function(e,t){n.push({name:e.attributes.站名,type:e.attributes.性质,tieluju:e.attributes.铁路局,address:e.attributes.省,lon:e.attributes.lng火星,lat:e.attributes.lat火星,key:t})}))):n.length=0,t.$message({message:"查询成功，共查到 ".concat(e.features.length," 条数据"),type:"success"}),t.$store.commit("_setDefaultQueryResult",n),t.$store.commit("_setDefaultQueryResultVisible",!0)})).catch((function(e){console.log(e),t.$message.error("空间查询失败，请联系管理员")}))}else t.$message({message:"尚未添加业务图层，不能进行空间查询",type:"warning"})},renderResultLayer:function(e){var t=this;return(0,x.Z)((0,M.Z)().mark((function n(){var a,r,s,i,o,l,c,u;return(0,M.Z)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=t.$store.getters._getDefaultMapView,n.next=3,(0,V.loadModules)(["esri/layers/FeatureLayer"],$.options);case 3:r=n.sent,s=(0,k.Z)(r,1),i=s[0],o=a.map.findLayerById("initResultLayer"),o&&a.map.remove(o),l=t._translateLonLat(e),c={title:"{name}-{adress}",content:[{type:"fields",fieldInfos:[{fieldName:"name",label:"名称"},{fieldName:"type",label:"类型"},{fieldName:"tieluju",label:"铁路局"},{fieldName:"address",label:"省"}]}]},u=new i({source:l,id:"initResultLayer",objectIdField:"FID",renderer:{type:"simple",symbol:{type:"picture-marker",url:"static/icon/train.png",width:"25px",height:"25px"}},fields:[{name:"FID",type:"oid"},{name:"name",type:"string"},{name:"tieluju",type:"string"},{name:"type",type:"string"},{name:"address",type:"string"}],popupTemplate:c}),a.map.add(u);case 12:case"end":return n.stop()}}),n)})))()},_translateLonLat:function(e){var t=this;return e.length>0&&(t.geoData=[],e.map((function(e,n){t.geoData.push({geometry:{type:"point",x:Number(e.attributes.lng火星),y:Number(e.attributes.lat火星)},attributes:{FID:n+1,name:e.attributes.站名,type:e.attributes.性质,tieluju:e.attributes.铁路局,address:e.attributes.省}})}))),t.geoData},_initSwipe:function(){var e=this;return(0,x.Z)((0,M.Z)().mark((function t(){var n,a,r,s,i,o,l;return(0,M.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e,a=n.$store.getters._getDefaultMapView,t.next=4,(0,V.loadModules)(["esri/widgets/Swipe"],$.options);case 4:if(r=t.sent,s=(0,k.Z)(r,1),i=s[0],o=a.map.findLayerById("swipeLayerTop"),l=a.map.findLayerById("swipeLayerBottom"),!o||!l){t.next=14;break}n.swipe=new i({leadingLayers:[o],trailingLayers:[l],position:35,view:a}),a.ui.add(n.swipe),t.next=16;break;case 14:return n.$message({message:"请添加至少两张业务图层",type:"warning"}),t.abrupt("return");case 16:case"end":return t.stop()}}),t)})))()},handlePrintMap:function(){var e=this;return(0,x.Z)((0,M.Z)().mark((function t(){var n,a,r,s,i,o,l,c,u,p;return(0,M.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e,a=n.$store.getters._getDefaultMapView,t.next=4,(0,V.loadModules)(["esri/tasks/PrintTask","esri/tasks/support/PrintTemplate","esri/tasks/support/PrintParameters"],$.options);case 4:r=t.sent,s=(0,k.Z)(r,3),i=s[0],o=s[1],l=s[2],c=new i({url:"https://utility.arcgisonline.com/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task"}),u=new o({format:"pdf",exportOptions:{dpi:100},layout:"a4-portrait",layoutOptions:{titleText:"地图出图demo",authorText:"admin",customTextElements:[{location:"四川省 成都市"},{date:"08/11/2021, 08:20:20 AM"}]}}),p=new l({view:a,template:u}),c.execute(p).then((function(t,n){console.log(t,n),t.url&&window.open(t.url),n&&e.$message.error("地图打印失败")}));case 13:case"end":return t.stop()}}),t)})))()},openMapPopup:function(){var e=this,t=e.$store.getters._getDefaultMapView,n=t.map.findLayerById("layerid");n?t.on("click",(function(e){t.hitTest(e).then((function(e){if(console.log("1",e),e.results.length){var t=e.results.filter((function(e){return"layerid"===e.graphic.layer.id}))[0].graphic;console.log(t.attributes)}}))})):e.$message({message:"请添加业务图层",type:"warning"})},handleClearMap:function(){var e=this.$store.getters._getDefaultMapView,t=e.map.findLayerById("swipeLayerTop"),n=e.map.findLayerById("swipeLayerBottom"),a=e.map.findLayerById("layerid"),r=e.map.findLayerById("measurementGraphicLayer");t&&e.map.remove(t),n&&e.map.remove(n),a&&e.map.remove(a),r&&e.map.remove(r),this.swipe&&this.swipe.destroy(),this.measurementWidget&&this.measurementWidget.destroy()}}}),Y=q,J=(0,m.Z)(Y,U,W,!1,null,null,null),K=J.exports,ee=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"show",rawName:"v-show",value:this.$store.getters._getDefaultMapTreeVisible,expression:"this.$store.getters._getDefaultMapTreeVisible"}],staticClass:"maptree-pannel"},[n("div",{staticClass:"maptree-header"},[n("span",[e._v("图层管理")]),n("i",{staticClass:"el-icon-close",on:{click:e.closeMapTreePannel}})]),n("el-tree",{attrs:{data:e.data,props:e.defaultProps},on:{"node-click":e.handleNodeClick}})],1)},te=[],ne=(n(74916),n(23123),{name:"MapTree",components:{},data:function(){return{data:[{label:"底图数据",children:[{label:"暖色系图层",layerid:"layerid",layerurl:"http://map.geoq.cn/arcgis/rest/services/ChinaOnlineStreetWarm/MapServer"},{label:"灰色系图层",layerid:"layerid",layerurl:"http://map.geoq.cn/arcgis/rest/services/ChinaOnlineStreetGray/MapServer"}]},{label:"行政区划数据",children:[{label:"省数据",layerid:"layerid",layerurl:"https://services3.arcgis.com/U26uBjSD32d7xvm2/arcgis/rest/services/sheng/FeatureServer"},{label:"市数据",layerid:"layerid",layerurl:"https://services3.arcgis.com/U26uBjSD32d7xvm2/arcgis/rest/services/cityccc/FeatureServer"},{label:"县数据",layerid:"layerid",layerurl:"https://services3.arcgis.com/U26uBjSD32d7xvm2/arcgis/rest/services/county/FeatureServer"}]},{label:"业务数据",children:[{label:"火车站数据",layerid:"layerid",layerurl:"https://services3.arcgis.com/U26uBjSD32d7xvm2/arcgis/rest/services/station/FeatureServer"},{label:"卷帘分析 top",layerid:"swipeLayerTop",layerurl:"https://services3.arcgis.com/U26uBjSD32d7xvm2/arcgis/rest/services/cityccc/FeatureServer"},{label:"卷帘分析 bottom",layerid:"swipeLayerBottom",layerurl:"https://services3.arcgis.com/U26uBjSD32d7xvm2/arcgis/rest/services/county/FeatureServer"}]}],defaultProps:{children:"children",label:"label"}}},mounted:function(){},methods:{handleNodeClick:function(e){var t=this;return(0,x.Z)((0,M.Z)().mark((function n(){var a,r,s,i,o,l,c,u,p;return(0,M.Z)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!e.layerurl){n.next=22;break}return a=t.$store.getters._getDefaultMapView,r=a.map.findLayerById("layerid"),r&&a.map.remove(r),n.next=6,(0,V.loadModules)(["esri/layers/TileLayer","esri/layers/FeatureLayer"],$.options);case 6:s=n.sent,i=(0,k.Z)(s,2),o=i[0],l=i[1],c=e.layerurl.split("/"),u=c[c.length-1],p="",n.t0=u,n.next="MapServer"===n.t0?16:"FeatureServer"===n.t0?18:20;break;case 16:return p=new o({url:e.layerurl,id:e.layerid}),n.abrupt("break",21);case 18:return p=new l({url:e.layerurl,id:e.layerid}),n.abrupt("break",21);case 20:return n.abrupt("break",21);case 21:a.map.add(p);case 22:case"end":return n.stop()}}),n)})))()},closeMapTreePannel:function(){var e=this.$store.getters._getDefaultMapTreeVisible;this.$store.commit("_setDefaultMapTreeVisible",!e)}}}),ae=ne,re=(0,m.Z)(ae,ee,te,!1,null,null,null),se=re.exports,ie=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"show",rawName:"v-show",value:this.$store.getters._getDefaultXZQHVisible,expression:"this.$store.getters._getDefaultXZQHVisible"}],staticClass:"XZQHComponent-pannel"},[n("div",{staticClass:"XZQHComponent-header"},[n("span",[e._v("行政区划导航")]),n("i",{staticClass:"el-icon-close",on:{click:e.closeXZQHPannel}})]),n("div",{staticClass:"XZQH-select-pannel"},[n("span",{staticClass:"XZQH-select-label"},[e._v("省份：")]),n("el-select",{attrs:{size:"mini",clearable:"",placeholder:"请选择省份"},on:{change:e.handleProvinceValueChange},model:{value:e.provinceValue,callback:function(t){e.provinceValue=t},expression:"provinceValue"}},e._l(e.provinceOptions,(function(e){return n("el-option",{key:e.label,attrs:{label:e.label,value:e.value}})})),1)],1),n("div",{staticClass:"XZQH-content-pannel"},[n("tbody",e._l(e.cityAndCountyOptions,(function(t){return n("tr",{key:t.label},[n("td",{staticStyle:{"min-width":"50px"}},[n("span",{staticClass:"city-item",attrs:{value:t.value},on:{click:function(n){return e.handleItemClick(t.value,"city")}}},[e._v(" "+e._s(t.label)+" ")])]),n("td",e._l(t.children,(function(t){return n("span",{key:t.attributes.NAME,staticClass:"county-item",attrs:{value:t.attributes.PAC},on:{click:function(n){return e.handleItemClick(t.attributes.PAC,"county")}}},[e._v(e._s(t.attributes.NAME))])})),0)])})),0)])])},oe=[],le=(n(39714),n(78783),n(33948),""),ce={name:"XZQHComponent",components:{},data:function(){return{provinceOptions:[],provinceValue:"",cityAndCountyOptions:[]}},mounted:function(){this.getProvinceData()},methods:{getProvinceData:function(){var e=this;return(0,x.Z)((0,M.Z)().mark((function t(){var n,a,r,s,i,o,l;return(0,M.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e,t.next=3,(0,V.loadModules)(["esri/tasks/QueryTask","esri/tasks/support/Query"],$.options);case 3:a=t.sent,r=(0,k.Z)(a,2),s=r[0],i=r[1],o=new s({url:"https://services3.arcgis.com/U26uBjSD32d7xvm2/arcgis/rest/services/sheng/FeatureServer/2"}),l=new i,l.returnGeometry=!1,l.outFields=["*"],l.where="1=1",o.execute(l).then((function(e){var t=[];e.features.length>0?(e.features.map((function(e){t.push({value:e.attributes.省代码,label:e.attributes.省})})),n.provinceOptions=t):n.$message({message:"暂时没有省份数据",type:"warning"})}));case 13:case"end":return t.stop()}}),t)})))()},handleProvinceValueChange:function(e){var t=this;return(0,x.Z)((0,M.Z)().mark((function n(){return(0,M.Z)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:t.getCityAndCountyData(e);case 1:case"end":return n.stop()}}),n)})))()},getCityAndCountyData:function(e){var t=this;return(0,x.Z)((0,M.Z)().mark((function n(){var a,r,s,i,o,l,c,u,p,m;return(0,M.Z)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=t,r=e.toString().substring(0,2),n.next=4,(0,V.loadModules)(["esri/tasks/QueryTask","esri/tasks/support/Query"],$.options);case 4:return s=n.sent,i=(0,k.Z)(s,2),o=i[0],l=i[1],c=new o({url:"https://services3.arcgis.com/U26uBjSD32d7xvm2/arcgis/rest/services/cityccc/FeatureServer/5"}),u=new l,u.returnGeometry=!1,u.outFields=["*"],u.where="市代码 like '"+r+"%'",n.next=15,c.execute(u);case 15:p=n.sent,m=[],p.features.length>0?(p.features.map((function(e){m.push({value:e.attributes.市代码,label:e.attributes.市})})),Promise.all(m.map(function(){var e=(0,x.Z)((0,M.Z)().mark((function e(t){var n,a,r,s;return(0,M.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.value.toString().substring(0,4),a=new o({url:"https://services3.arcgis.com/U26uBjSD32d7xvm2/arcgis/rest/services/county/FeatureServer/4"}),r=new l,r.returnGeometry=!1,r.outFields=["*"],r.where="市代码 like '"+n+"%'",e.next=8,a.execute(r);case 8:return s=e.sent,t.children=s.features,console.log(n),e.abrupt("return",t);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())).then((function(e){t.cityAndCountyOptions=e}))):a.$message({message:"暂时没有市级数据",type:"warning"});case 18:case"end":return n.stop()}}),n)})))()},handleItemClick:function(e,t){var n=this;return(0,x.Z)((0,M.Z)().mark((function a(){var r,s,i,o,l,c,u,p,m,d,g,h,f;return(0,M.Z)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r="",s="",i=n.$store.getters._getDefaultMapView,"city"===t?(s=e.toString().substring(0,4),r="https://services3.arcgis.com/U26uBjSD32d7xvm2/arcgis/rest/services/cityccc/FeatureServer/5"):"county"===t&&(s=e.toString().substring(0,6),r="https://services3.arcgis.com/U26uBjSD32d7xvm2/arcgis/rest/services/county/FeatureServer/4"),a.next=6,(0,V.loadModules)(["esri/tasks/QueryTask","esri/tasks/support/Query","esri/Graphic"],$.options);case 6:return o=a.sent,l=(0,k.Z)(o,3),c=l[0],u=l[1],p=l[2],m=new c({url:r}),d=new u,d.returnGeometry=!0,d.outFields=["*"],"city"===t?d.where="省代码 like '"+s+"%'":"county"===t&&(d.where="PAC like '"+s+"%'"),a.next=18,m.execute(d);case 18:g=a.sent,h=g.features[0],le&&i.graphics.remove(le),f={type:"simple-fill",color:[188,240,234,.1],outline:{color:"#00FFFF",width:2}},le=new p({geometry:h.geometry,symbol:f}),i.graphics.add(le),i.goTo({center:[h.geometry.extent.center.longitude,h.geometry.extent.center.latitude],zoom:8});case 25:case"end":return a.stop()}}),a)})))()},closeXZQHPannel:function(){var e=this.$store.getters._getDefaultXZQHVisible;this.$store.commit("_setDefaultXZQHVisible",!e)}}},ue=ce,pe=(0,m.Z)(ue,ie,oe,!1,null,null,null),me=pe.exports,de=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"show",rawName:"v-show",value:this.$store.getters._getDefaultQueryResultVisible,expression:"this.$store.getters._getDefaultQueryResultVisible"}],staticClass:"result-table-view"},[n("div",{staticClass:"result-table-header"},[n("span",[e._v("空间查询结果")]),n("i",{staticClass:"el-icon-close",on:{click:e.closeResultQueryPannel}})]),n("div",{staticClass:"result-table-content"},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:this.$store.getters._getDefaultQueryResult,height:"250"}},[n("el-table-column",{attrs:{prop:"name",label:"站名"}}),n("el-table-column",{attrs:{prop:"type",label:"类型"}}),n("el-table-column",{attrs:{prop:"tieluju",label:"铁路局"}}),n("el-table-column",{attrs:{prop:"address",label:"地址"}})],1)],1)])},ge=[],he={name:"ResultTable",methods:{closeResultQueryPannel:function(){var e=this.$store.getters._getDefaultQueryResultVisible;this.$store.commit("_setDefaultQueryResultVisible",!e)}}},fe=he,ve=(0,m.Z)(fe,de,ge,!1,null,null,null),we=ve.exports,ye={name:"OneMap",components:{Mapview:G,MapTools:K,MapTree:se,XZQHComponent:me,ResultTable:we},methods:{}},be=ye,_e=(0,m.Z)(be,F,j,!1,null,null,null),Me=_e.exports,ke=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"morescreen-view"},[e._m(0),e._m(1),n("div",[n("el-button",{staticClass:"maptools-view",on:{click:e.back}},[e._v("返回")])],1)])},xe=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"morescreen-top-view"},[n("div",{staticClass:"map-item",attrs:{id:"top-left"}}),n("div",{staticClass:"map-item",attrs:{id:"top-right"}})])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"morescreen-bottom-view"},[n("div",{staticClass:"map-item",attrs:{id:"buttom-left"}}),n("div",{staticClass:"map-item",attrs:{id:"buttom-right"}})])}],Te={name:"MoreScreen",mounted:function(){this._initMap()},methods:{_initMap:function(){return(0,x.Z)((0,M.Z)().mark((function e(){var t,n,a,r,s,i,o,l,c,u,p,m,d,g,h,f,v,w,y;return(0,M.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,V.loadModules)(["esri/Map","esri/views/MapView","esri/Basemap","esri/layers/TileLayer","esri/core/watchUtils"],$.options);case 2:t=e.sent,n=(0,k.Z)(t,4),a=n[0],r=n[1],s=n[2],i=n[3],o=new s({baseLayers:[new i({url:"http://map.geoq.cn/arcgis/rest/services/ChinaOnlineStreetPurplishBlue/MapServer",title:"Basemap"})],title:"basemap",id:"basemap"}),l=new a({basemap:o}),c=new r({container:"top-left",map:l,zoom:10,center:[104.072745,30.663774]}),u=new a({basemap:o}),p=new r({container:"top-right",map:u,zoom:10,center:[104.072745,30.663774]}),m=new a({basemap:o}),d=new r({container:"buttom-left",map:m,zoom:10,center:[104.072745,30.663774]}),g=new a({basemap:o}),h=new r({container:"buttom-right",map:g,zoom:10,center:[104.072745,30.663774]}),c.ui.components=[],p.ui.components=[],d.ui.components=[],h.ui.components=[],f=!0,v=!0,w=!0,y=!0,c.on("mouse-wheel",(function(){f?window.setTimeout((function(){p.goTo({center:[c.center.longitude,c.center.latitude],zoom:c.zoom}),d.goTo({center:[c.center.longitude,c.center.latitude],zoom:c.zoom}),h.goTo({center:[c.center.longitude,c.center.latitude],zoom:c.zoom}),v=!1,w=!1,y=!1}),100):f||(f=!0)})),c.on("drag",(function(){console.log(f),f?window.setTimeout((function(){p.goTo({center:[c.center.longitude,c.center.latitude],zoom:c.zoom}),d.goTo({center:[c.center.longitude,c.center.latitude],zoom:c.zoom}),h.goTo({center:[c.center.longitude,c.center.latitude],zoom:c.zoom}),y=!1}),100):f||(f=!0)})),p.on("mouse-wheel",(function(){v?window.setTimeout((function(){c.goTo({center:[p.center.longitude,p.center.latitude],zoom:p.zoom}),d.goTo({center:[p.center.longitude,p.center.latitude],zoom:p.zoom}),h.goTo({center:[p.center.longitude,p.center.latitude],zoom:p.zoom}),v=!1,w=!1,y=!1}),100):v||(v=!0)})),p.on("drag",(function(){console.log(v),v?window.setTimeout((function(){c.goTo({center:[p.center.longitude,p.center.latitude],zoom:p.zoom}),d.goTo({center:[p.center.longitude,p.center.latitude],zoom:p.zoom}),h.goTo({center:[p.center.longitude,p.center.latitude],zoom:p.zoom}),y=!1}),100):v||(v=!0)})),d.on("mouse-wheel",(function(){w?window.setTimeout((function(){c.goTo({center:[d.center.longitude,d.center.latitude],zoom:d.zoom}),p.goTo({center:[d.center.longitude,d.center.latitude],zoom:d.zoom}),h.goTo({center:[d.center.longitude,d.center.latitude],zoom:d.zoom}),v=!1,f=!1,y=!1}),100):w||(f=!0)})),d.on("drag",(function(){console.log(w),w?window.setTimeout((function(){c.goTo({center:[d.center.longitude,d.center.latitude],zoom:d.zoom}),p.goTo({center:[d.center.longitude,d.center.latitude],zoom:d.zoom}),h.goTo({center:[d.center.longitude,d.center.latitude],zoom:d.zoom}),y=!1}),100):w||(w=!0)})),h.on("mouse-wheel",(function(){y?window.setTimeout((function(){p.goTo({center:[h.center.longitude,h.center.latitude],zoom:h.zoom}),d.goTo({center:[h.center.longitude,h.center.latitude],zoom:h.zoom}),c.goTo({center:[h.center.longitude,h.center.latitude],zoom:h.zoom}),v=!1,w=!1,f=!1}),100):y||(y=!0)})),h.on("drag",(function(){console.log(y),y?window.setTimeout((function(){p.goTo({center:[h.center.longitude,h.center.latitude],zoom:h.zoom}),d.goTo({center:[h.center.longitude,h.center.latitude],zoom:h.zoom}),c.goTo({center:[h.center.longitude,h.center.latitude],zoom:h.zoom}),f=!1}),100):y||(y=!0)}));case 33:case"end":return e.stop()}}),e)})))()},back:function(){this.$router.push("/onemap")}}},Ze=Te,Ce=(0,m.Z)(Ze,ke,xe,!1,null,null,null),De=Ce.exports;a["default"].use(v.Z);var Ve=new v.Z({routes:[{path:"/",component:O},{path:"/onemap",component:Me},{path:"/onemap/one",component:De}],mode:"history"}),Se=n(34665);a["default"].use(Se.ZP);var $e={_defaultMapView:"",_defaultXZQHVisible:!1,_defaultMapTreeVisible:!1,_defaultQueryResultVisible:!1,_defaultQueryResult:[]},ze={_getDefaultMapView:function(){return $e._defaultMapView},_getDefaultXZQHVisible:function(){return $e._defaultXZQHVisible},_getDefaultMapTreeVisible:function(){return $e._defaultMapTreeVisible},_getDefaultQueryResultVisible:function(){return $e._defaultQueryResultVisible},_getDefaultQueryResult:function(){return $e._defaultQueryResult}},Ie={_setDefaultMapView:function(e,t){e._defaultMapView=t},_setDefaultXZQHVisible:function(e,t){e._defaultXZQHVisible=t},_setDefaultMapTreeVisible:function(e,t){e._defaultMapTreeVisible=t},_setDefaultQueryResultVisible:function(e,t){e._defaultQueryResultVisible=t},_setDefaultQueryResult:function(e,t){e._defaultQueryResult=t}},Le=new Se.ZP.Store({state:$e,getters:ze,mutations:Ie}),Pe=Le;a["default"].prototype.$echarts=D(),a["default"].config.productionTip=!1,a["default"].use(f()),new a["default"]({store:Pe,router:Ve,render:function(e){return e(g)}}).$mount("#app")},24654:function(){}},t={};function n(a){var r=t[a];if(void 0!==r)return r.exports;var s=t[a]={exports:{}};return e[a].call(s.exports,s,s.exports,n),s.exports}n.m=e,function(){var e=[];n.O=function(t,a,r,s){if(!a){var i=1/0;for(u=0;u<e.length;u++){a=e[u][0],r=e[u][1],s=e[u][2];for(var o=!0,l=0;l<a.length;l++)(!1&s||i>=s)&&Object.keys(n.O).every((function(e){return n.O[e](a[l])}))?a.splice(l--,1):(o=!1,s<i&&(i=s));if(o){e.splice(u--,1);var c=r();void 0!==c&&(t=c)}}return t}s=s||0;for(var u=e.length;u>0&&e[u-1][2]>s;u--)e[u]=e[u-1];e[u]=[a,r,s]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,a){var r,s,i=a[0],o=a[1],l=a[2],c=0;if(i.some((function(t){return 0!==e[t]}))){for(r in o)n.o(o,r)&&(n.m[r]=o[r]);if(l)var u=l(n)}for(t&&t(a);c<i.length;c++)s=i[c],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(u)},a=self["webpackChunkwebgis2"]=self["webpackChunkwebgis2"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=n.O(void 0,[998],(function(){return n(62764)}));a=n.O(a)})();
//# sourceMappingURL=app-legacy.76bb1557.js.map